{{- if not .Values.credentials.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "qualys-ca.fullname" . }}-credentials
  namespace: {{ .Values.namespace.name }}
  labels:
    {{- include "qualys-ca.labels" . | nindent 4 }}
type: Opaque
immutable: true
data:
  # Required credentials
  ACTIVATION_ID: {{ .Values.credentials.activationId | b64enc | quote }}
  CUSTOMER_ID: {{ .Values.credentials.customerId | b64enc | quote }}

  # Proxy URLs (may contain embedded credentials)
  {{- if .Values.proxy.qualysHttpsProxy }}
  QUALYS_HTTPS_PROXY: {{ .Values.proxy.qualysHttpsProxy | b64enc | quote }}
  {{- end }}
  {{- if .Values.proxy.httpsProxy }}
  HTTPS_PROXY: {{ .Values.proxy.httpsProxy | b64enc | quote }}
  {{- end }}

  # Custom CA certificate bundle for proxy SSL/TLS
  {{- if .Values.proxy.caCertBundle }}
  CA_CERT_BUNDLE: {{ .Values.proxy.caCertBundle | quote }}
  {{- end }}
{{- end }}
